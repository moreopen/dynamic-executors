<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:jdbc="http://www.springframework.org/schema/jdbc" xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                     http://www.springframework.org/schema/beans/spring-beans.xsd
                     http://www.springframework.org/schema/tx
                     http://www.springframework.org/schema/tx/spring-tx.xsd
                     http://www.springframework.org/schema/context
                     http://www.springframework.org/schema/context/spring-context.xsd
                     http://www.springframework.org/schema/aop
                     http://www.springframework.org/schema/aop/spring-aop.xsd
                     http://www.springframework.org/schema/jdbc
                     http://www.springframework.org/schema/jdbc/spring-jdbc-3.2.xsd
                     http://www.springframework.org/schema/util
                     http://www.springframework.org/schema/util/spring-util-3.2.xsd
                     http://www.springframework.org/schema/mvc
                     http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd">

    <!-- scan package, annotation-config -->
    <context:annotation-config/>
    <context:component-scan base-package="com.moreopen.executors">
        <!-- <context:exclude-filter type="regex" expression="com.moreopen.executors.demo.controllers.*"/> -->
    </context:component-scan>

    <!-- ZkConfig center -->
    <!-- ====================================================================================================================================== -->
    
    <bean id="propertyConfigurer" class="com.moreopen.config.agent.zk.ZkAwaredPropertyPlaceholderConfigurer">
        <property name="zkBasedConfiguration" ref="zkBasedConfiguration" />
        <property name="locations">
            <list>
                <value>classpath:app.properties</value>
            </list>
        </property>
    </bean>


    <bean id="zkAwaredBeanPostProcessor" class="com.moreopen.config.agent.zk.ZkAwaredBeanPostProcessor">
        <property name="zkBasedConfiguration" ref="zkBasedConfiguration" />
    </bean>

    <bean id="zkBasedConfiguration" class="com.moreopen.config.agent.configuration.ZkBasedConfiguration">
        <property name="app" value="${zk.appName}" />
        <property name="globalApp" value="${zk.globalApp}" />
        <property name="localConfiguration" ref="localFileConfiguration" />
    </bean>

    <bean id="localFileConfiguration" class="com.moreopen.config.agent.configuration.LocalFileConfiguration">
        <property name="filePath" value="${zk.localFile}" />
    </bean>
    
    <!---============================ Dynamic Executors 核心配置 =======================-->
    <!--=============================LocalConfigExecutorGroupFactory=====================-->
    <!-- <bean id="executorGroupFactory" class="com.moreopen.executors.LocalConfigExecutorGroupFactory" init-method="init">
    	<property name="localFile" value="executors.conf"/>
    </bean> -->
    
    <!--============================ZKConfigExecutorGroupFactory============================-->
    <bean id="zkClient" class="com.moreopen.executors.zk.ExecutorsConfigZKClient" init-method="init">
    	<property name="connectionString" value="test-dubbo-zk-01.im.int:2181"/>
    </bean>
    <bean id="executorGroupFactory" class="com.moreopen.executors.ZKConfigExecutorGroupFactory" init-method="init">
    	<property name="appNodeName" value="sayHi-demo"/>
    	<property name="zkClient" ref="zkClient"/>
    </bean>
    
    <bean id="executorGroup" factory-bean="executorGroupFactory" factory-method="create"/>
    
    <bean id="executorGroupMonitor" class="com.moreopen.executors.DefaultExecutorGroupMonitor" init-method="start">
    	<property name="executorGroup" ref="executorGroup"/>
    	<property name="monitorDataUploader" ref="monitorDataUploader"/>
    </bean>

</beans>
